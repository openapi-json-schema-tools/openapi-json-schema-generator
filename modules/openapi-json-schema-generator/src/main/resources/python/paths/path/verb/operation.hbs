# coding: utf-8

{{> _helper_header }}

from {{packageName}} import api_client{{#neq operation.security null}}{{#gt operation.security.size 0}}, security_schemes{{/gt}}{{else}}{{#neq security null}}{{#gt security.size 0}}, security_schemes{{/gt}}{{/neq}}{{/neq}}
{{#eq operation.security null}}
    {{#neq security null}}
        {{#gt security.size 0}}
            {{#eq security.size 1}}
                {{#each security}}
from {{packageName}}.security import security_requirement_object_{{@key}}
                {{/each}}
            {{else}}
from {{packageName}}.security import (
                {{#each security}}
    security_requirement_object_{{@key}},
                {{/each}}
)
            {{/eq}}
        {{/gt}}
    {{/neq}}
{{/eq}}
from {{packageName}}.shared_imports.operation_imports import *
{{#if imports}}

{{/if}}
{{> _helper_imports }}
{{#with operation}}

from .. import path
{{#if responses}}
    {{#eq responses.size 1}}
        {{#each responses}}
from .responses import response_{{@key}}
        {{/each}}
    {{else}}
from .responses import (
        {{#each responses}}
    {{jsonPathPiece.snakeCase}},
        {{/each}}
)
    {{/eq}}
{{/if}}
{{#if requestBody}}
from . import request_body
{{/if}}
{{#gt allParams.size 0}}
    {{#eq allParams.size 1}}
        {{#each allParams}}
from .parameters import {{jsonPathPiece.snakeCase}}
        {{/each}}
    {{else}}
from .parameters import (
        {{#each allParams}}
    {{jsonPathPiece.snakeCase}},
        {{/each}}
)
    {{/eq}}
{{/gt}}
{{#neq security null}}
    {{#gt security.size 0}}
        {{#eq security.size 1}}
            {{#each security}}
from .security import security_requirement_object_{{@key}}
            {{/each}}
        {{else}}
from .security import (
            {{#each security}}
    security_requirement_object_{{@key}},
            {{/each}}
)
        {{/eq}}
    {{/gt}}
{{/neq}}

{{#or queryParams headerParams pathParams cookieParams}}
    {{#if queryParams}}
{{> paths/path/verb/_helper_operation_parameter_schema_and_def xParams=queryParams xParamsName="RequestQueryParameters" }}
    {{/if}}
    {{#if headerParams}}
{{> paths/path/verb/_helper_operation_parameter_schema_and_def xParams=headerParams xParamsName="RequestHeaderParameters" }}
    {{/if}}
    {{#if pathParams}}
{{> paths/path/verb/_helper_operation_parameter_schema_and_def xParams=pathParams xParamsName="RequestPathParameters" }}
    {{/if}}
    {{#if cookieParams}}
{{> paths/path/verb/_helper_operation_parameter_schema_and_def xParams=cookieParams xParamsName="RequestCookieParameters" }}
    {{/if}}
{{/or}}
{{#neq security null}}
    {{#gt security.size 0}}

_security: typing.List[security_schemes.SecurityRequirementObject] = [
        {{#each security}}
    security_requirement_object_{{@key}}.security_requirement_object,
        {{/each}}
]
    {{/gt}}
{{else}}
    {{#neq ../security null}}
        {{#gt ../security.size 0}}

_security: typing.List[security_schemes.SecurityRequirementObject] = [
            {{#each ../security}}
    security_requirement_object_{{@key}}.security_requirement_object,
            {{/each}}
]
        {{/gt}}
    {{/neq}}
{{/neq}}


    {{#if defaultResponse}}
        {{#with defaultResponse}}
default_response = response_default.{{jsonPathPiece.camelCase}}
        {{/with}}
    {{/if}}
    {{#if statusCodeResponses}}
__StatusCodeToResponse = typing_extensions.TypedDict(
    '__StatusCodeToResponse',
    {
        {{#each statusCodeResponses}}
        '{{@key}}': typing.Type[{{jsonPathPiece.snakeCase}}.{{jsonPathPiece.camelCase}}],
        {{/each}}
    }
)
_status_code_to_response: __StatusCodeToResponse = {
        {{#each statusCodeResponses}}
    '{{@key}}': {{jsonPathPiece.snakeCase}}.{{jsonPathPiece.camelCase}},
        {{/each}}
}
    {{/if}}
    {{#if wildcardCodeResponses}}
__RangedStatusCodeToResponse = typing_extensions.TypedDict(
    '__RangedStatusCodeToResponse',
    {
        {{#each wildcardCodeResponses}}
        '{{@key}}': typing.Type[{{jsonPathPiece.snakeCase}}.{{jsonPathPiece.camelCase}}],
        {{/each}}
    }
)
_ranged_status_code_to_response: __RangedStatusCodeToResponse = {
        {{#each wildcardCodeResponses}}
    '{{@key}}': {{jsonPathPiece.snakeCase}}.{{jsonPathPiece.camelCase}},
        {{/each}}
}
    {{/if}}
{{#each produces}}
    {{#if @first}}

_all_accept_content_types = (
    {{/if}}
    "{{{.}}}",
    {{#if @last}}
)
    {{/if}}
{{/each}}


class BaseApi(api_client.Api):
    @typing.overload
    def _{{operationId.snakeCase}}(
    {{> paths/path/verb/_helper_operation_args rootSecurity=../security isOverload=true skipDeserialization="False"}}

    @typing.overload
    def _{{operationId.snakeCase}}(
    {{> paths/path/verb/_helper_operation_args rootSecurity=../security isOverload=true skipDeserialization="True"}}

    def _{{operationId.snakeCase}}(
    {{> paths/path/verb/_helper_operation_args rootSecurity=../security isOverload=false skipDeserialization="null"}}
        """
    {{#if summary}}
        {{summary}}
    {{/if}}
        :param skip_deserialization: If true then api_response.response will be set but
            api_response.body and api_response.headers will not be deserialized into schema
            class instances
        """
    {{#if queryParams}}
        self._verify_typed_dict_inputs(RequestQueryParameters.Params, query_params)
    {{/if}}
    {{#if headerParams}}
        self._verify_typed_dict_inputs(RequestHeaderParameters.Params, header_params)
    {{/if}}
    {{#if pathParams}}
        self._verify_typed_dict_inputs(RequestPathParameters.Params, path_params)
    {{/if}}
    {{#if cookieParams}}
        self._verify_typed_dict_inputs(RequestCookieParameters.Params, cookie_params)
    {{/if}}
    {{#or pathParams queryParams}}
        used_path = self._get_used_path(
            path,
        {{#if pathParams}}
            path_parameters=RequestPathParameters.parameters,
            path_params=path_params{{#if queryParams}},{{/if}}
        {{/if}}
        {{#if queryParams}}
            query_parameters=RequestQueryParameters.parameters,
            query_params=query_params
        {{/if}}
        )
    {{else}}
        used_path = path
    {{/or}}
    {{#or headerParams requestBody produces}}
        {{#if headerParams}}
        _headers = self._get_headers(
            {{#if produces}}
            header_parameters=RequestHeaderParameters.parameters,
            header_params=header_params,
            accept_content_types=accept_content_types
            {{else}}
            header_parameters=RequestHeaderParameters.parameters,
            header_params=header_params
            {{/if}}
        )
        {{else}}
        _headers = self._get_headers({{#if produces}}accept_content_types=accept_content_types{{/if}})
        {{/if}}
    {{/or}}
        # TODO add cookie handling
    {{#with requestBody}}

        _fields, _body = self._get_fields_and_body(
            request_body=request_body.{{jsonPathPiece.camelCase}},
            body=body,
            headers=_headers,
            content_type=content_type
        )
    {{/with}}
    {{#if servers}}
        host = self.api_client.configuration.get_server_url(
            'paths/' + path + '/{{httpMethod.original}}/servers', server_index
        )
    {{else}}
        {{#if pathItem.servers}}
        host = self.api_client.configuration.get_server_url(
            'paths/' + path + '/servers', server_index
        )
        {{else}}
        host = self.api_client.configuration.get_server_url(
            'servers', server_index
        )
        {{/if}}
    {{/if}}
    {{#neq security null}}
        {{#gt security.size 0}}
        security_requirement_object = self.api_client.configuration.get_security_requirement_object(
            'paths/' + path + '/{{httpMethod.original}}/security',
            _security,
            security_index
        )
        {{/gt}}
    {{else}}
        {{#neq ../security null}}
            {{#gt ../security.size 0}}
        security_requirement_object = self.api_client.configuration.get_security_requirement_object(
            'servers',
            _security,
            security_index
        )
            {{/gt}}
        {{/neq}}
    {{/neq}}

        raw_response = self.api_client.call_api(
            resource_path=used_path,
            method='{{httpMethod.original}}',
            host=host,
    {{#or headerParams requestBody produces}}
            headers=_headers,
    {{/or}}
    {{#if requestBody}}
            fields=_fields,
            body=_body,
    {{/if}}
    {{#neq security null}}
        {{#gt security.size 0}}
            security_requirement_object=security_requirement_object,
        {{/gt}}
    {{else}}
        {{#neq ../security null}}
            {{#gt ../security.size 0}}
            security_requirement_object=security_requirement_object,
            {{/gt}}
        {{/neq}}
    {{/neq}}
            stream=stream,
            timeout=timeout,
        )

        if skip_deserialization:
            response = api_response.ApiResponseWithoutDeserialization(response=raw_response)
        else:
{{#if nonDefaultResponses}}
            status = str(raw_response.status)
    {{#if wildcardCodeResponses}}
            ranged_response_status_code = status[0]
    {{/if}}
    {{#if statusCodeResponses}}
            if status in _status_code_to_response:
                status = typing.cast(
                    typing_extensions.Literal[
        {{#each statusCodeResponses}}
                    '{{@key}}',
        {{/each}}
                    ],
                    status
                )
                response = _status_code_to_response[status].deserialize(
                    raw_response, self.api_client.schema_configuration)
        {{#if wildcardCodeResponses}}
            elif ranged_response_status_code in _ranged_status_code_to_response:
                ranged_response_status_code: typing_extensions.Literal[
        {{#each wildcardCodeResponses}}
                    '{{@key}}',
        {{/each}}
                ]
                response = _ranged_status_code_to_response[ranged_response_status_code].deserialize(
                    raw_response, self.api_client.schema_configuration)
        {{/if}}
    {{else}}
            if ranged_response_status_code in _ranged_status_code_to_response:
                ranged_response_status_code: typing_extensions.Literal[
        {{#each wildcardCodeResponses}}
                    '{{@key}}',
        {{/each}}
                ]
                response = _ranged_status_code_to_response[ranged_response_status_code].deserialize(
                    raw_response, self.api_client.schema_configuration)
    {{/if}}
            else:
    {{#if defaultResponse}}
                response = default_response.deserialize(raw_response, self.api_client.schema_configuration)
    {{else}}
                response = api_response.ApiResponseWithoutDeserialization(response=raw_response)
    {{/if}}
{{else}}
    {{#if defaultResponse}}
            response = default_response.deserialize(raw_response, self.api_client.schema_configuration)
    {{else}}
            response = api_response.ApiResponseWithoutDeserialization(response=raw_response)
    {{/if}}
{{/if}}

        self._verify_response_status(response)

        return response


class {{operationId.camelCase}}(BaseApi):
    # this class is used by api classes that refer to endpoints with operationId.snakeCase fn names
    {{operationId.snakeCase}} = BaseApi._{{operationId.snakeCase}}


class ApiFor{{httpMethod.camelCase}}(BaseApi):
    # this class is used by api classes that refer to endpoints by path and http method names
    {{httpMethod.original}} = BaseApi._{{operationId.snakeCase}}
{{/with}}
